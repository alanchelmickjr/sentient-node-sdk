<!-- Sentient Banner -->
<p align="center">
  <img src="banner.png"/>
</p>

<!-- Socials -->
<p align="center">
      <a href="https://sentient.xyz/" target="_blank" style="margin: 2px;">
    <img alt="Homepage" src="https://img.shields.io/badge/Website-Sentient.xyz-%23EAEAEA?logo=data%3Aimage%2Fsvg%2Bxml%3Bbase64%2CPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNDEuMzMzIiBoZWlnaHQ9IjM0MS4zMzMiIHZlcnNpb249IjEuMCIgdmlld0JveD0iMCAwIDI1NiAyNTYiPjxwYXRoIGQ9Ik0xMzIuNSAyOC40Yy0xLjUgMi4yLTEuMiAzLjkgNC45IDI3LjIgMy41IDEzLjcgOC41IDMzIDExLjEgNDIuOSAyLjYgOS45IDUuMyAxOC42IDYgMTkuNCAzLjIgMy4zIDExLjctLjggMTMuMS02LjQuNS0xLjktMTcuMS03Mi0xOS43LTc4LjYtMS4yLTMtNy41LTYuOS0xMS4zLTYuOS0xLjYgMC0zLjEuOS00LjEgMi40ek0xMTAgMzBjLTEuMSAxLjEtMiAzLjEtMiA0LjVzLjkgMy40IDIgNC41IDMuMSAyIDQuNSAyIDMuNC0uOSA0LjUtMiAyLTMuMSAyLTQuNS0uOS0zLjQtMi00LjUtMy4xLTItNC41LTItMy40LjktNC41IDJ6TTgxLjUgNDYuMWMtMi4yIDEuMi00LjYgMi44LTUuMiAzLjctMS44IDIuMy0xLjYgNS42LjUgNy40IDEuMyAxLjIgMzIuMSAxMC4yIDQ1LjQgMTMuMyAzIC44IDYuOC0yLjIgNi44LTUuMyAwLTMuNi0yLjItOS4yLTMuOS0xMC4xQzEyMy41IDU0LjIgODcuMiA0NCA4NiA0NGMtLjMuMS0yLjMgMS00LjUgMi4xek0xNjUgNDZjLTEuMSAxLjEtMiAyLjUtMiAzLjIgMCAyLjggMTEuMyA0NC41IDEyLjYgNDYuNS45IDEuNSAyLjQgMi4zIDQuMiAyLjMgMy44IDAgOS4yLTUuNiA5LjItOS40IDAtMS41LTIuMS0xMC45LTQuNy0yMC44bC00LjctMTguMS00LjUtMi44Yy01LjMtMy40LTcuNC0zLjYtMTAuMS0uOXpNNDguNyA2NS4xYy03LjcgNC4xLTYuOSAxMC43IDEuNSAxMyAyLjQuNiAyMS40IDUuOCA0Mi4yIDExLjYgMjIuOCA2LjIgMzguOSAxMC4yIDQwLjMgOS44IDMuNS0uOCA0LjYtMy44IDMuMi04LjgtMS41LTUuNy0yLjMtNi41LTguMy04LjJDOTQuMiA3My4xIDU2LjYgNjMgNTQuOCA2M2MtMS4zLjEtNCAxLTYuMSAyLjF6TTE5OC4yIDY0LjdjLTMuMSAyLjgtMy41IDUuNi0xLjEgOC42IDQgNS4xIDEwLjkgMi41IDEwLjktNC4xIDAtNS4zLTUuOC03LjktOS44LTQuNXpNMTgxLjggMTEzLjFjLTI3IDI2LjQtMzEuOCAzMS41LTMxLjggMzMuOSAwIDEuNi43IDMuNSAxLjUgNC40IDEuNyAxLjcgNy4xIDMgMTAuMiAyLjQgMi4xLS4zIDU2LjktNTMuNCA1OS01Ny4xIDEuNy0zLjEgMS42LTkuOC0uMy0xMi41LTMuNi01LjEtNC45LTQuMi0zOC42IDI4Ljl6TTM2LjYgODguMWMtNSA0LTIuNCAxMC45IDQuMiAxMC45IDMuMyAwIDYuMi0yLjkgNi4yLTYuMyAwLTIuMS00LjMtNi43LTYuMy02LjctLjggMC0yLjYuOS00LjEgMi4xek02My40IDk0LjVjLTEuNi43LTguOSA3LjMtMTYuMSAxNC43TDM0IDEyMi43djUuNmMwIDYuMyAxLjYgOC43IDUuOSA4LjcgMi4xIDAgNi0zLjQgMTkuOS0xNy4zIDkuNS05LjUgMTcuMi0xOCAxNy4yLTE4LjkgMC00LjctOC40LTguNi0xMy42LTYuM3pNNjIuOSAxMzAuNiAzNCAxNTkuNXY1LjZjMCA2LjIgMS44IDguOSA2IDguOSAzLjIgMCA2Ni02Mi40IDY2LTY1LjYgMC0zLjMtMy41LTUuNi05LjEtNi4ybC01LS41LTI5IDI4Ljl6TTE5Ni4zIDEzNS4yYy05IDktMTYuNiAxNy4zLTE2LjkgMTguNS0xLjMgNS4xIDIuNiA4LjMgMTAgOC4zIDIuOCAwIDUuMi0yIDE3LjktMTQuOCAxNC41LTE0LjcgMTQuNy0xNC45IDE0LjctMTkuMyAwLTUuOC0yLjItOC45LTYuMi04LjktMi42IDAtNS40IDIuMy0xOS41IDE2LjJ6TTk2IDEzNi44Yy0yLjkuOS04IDYuNi04IDkgMCAxLjMgMi45IDEzLjQgNi40IDI3IDMuNiAxMy42IDcuOSAzMC4zIDkuNyAzNy4yIDEuNyA2LjkgMy42IDEzLjMgNC4xIDE0LjIuNSAxIDIuNiAyLjcgNC44IDMuOCA2LjggMy41IDExIDIuMyAxMS0zLjIgMC0zLTIwLjYtODMuMS0yMi4xLTg1LjktLjktMS45LTMuNi0yLjgtNS45LTIuMXpNMTIwLjUgMTU4LjRjLTEuOSAyLjktMS4yIDguNSAxLjQgMTEuNiAxLjEgMS40IDEyLjEgNC45IDM5LjYgMTIuNSAyMC45IDUuOCAzOC44IDEwLjUgMzkuOCAxMC41czMuNi0xIDUuNy0yLjJjOC4xLTQuNyA3LjEtMTAuNi0yLjMtMTMuMi0yOC4yLTguMS03OC41LTIxLjYtODAuMy0yMS42LTEuNCAwLTMgMS0zLjkgMi40ek0yMTAuNyAxNTguOGMtMS44IDEuOS0yLjIgNS45LS45IDcuOCAxLjUgMi4zIDUgMy40IDcuNiAyLjQgNi40LTIuNCA1LjMtMTEuMi0xLjUtMTEuOC0yLjQtLjItNCAuMy01LjIgMS42ek02OS42IDE2MmMtMiAyLjItMy42IDQuMy0zLjYgNC44LjEgMi42IDEwLjEgMzguNiAxMS4xIDM5LjkgMi4yIDIuNiA5IDUuNSAxMS41IDQuOSA1LTEuMyA0LjktMy0xLjUtMjcuNy0zLjMtMTIuNy02LjUtMjMuNy03LjItMjQuNS0yLjItMi43LTYuNC0xLjctMTAuMyAyLjZ6TTQ5LjYgMTgxLjVjLTIuNCAyLjUtMi45IDUuNC0xLjIgOEM1MiAxOTUgNjAgMTkzIDYwIDE4Ni42YzAtMS45LS44LTQtMS44LTQuOS0yLjMtMi4xLTYuNi0yLjItOC42LS4yek0xMjguNSAxODdjLTIuMyAyLjUtMS4zIDEwLjMgMS42IDEyLjggMi4yIDEuOSAzNC44IDExLjIgMzkuNCAxMS4yIDMuNiAwIDEwLjEtNC4xIDExLTcgLjYtMS45LTEuNy03LTMuMS03LS4yIDAtMTAuMy0yLjctMjIuMy02cy0yMi41LTYtMjMuMy02Yy0uOCAwLTIuMy45LTMuMyAyek0xMzYuNyAyMTYuOGMtMy40IDMuOC0xLjUgOS41IDMuNSAxMC43IDMuOSAxIDguMy0zLjQgNy4zLTcuMy0xLjItNS4xLTcuNS03LjEtMTAuOC0zLjR6Ii8%2BPC9zdmc%2B&link=https%3A%2F%2Fhuggingface.co%2FSentientagi"/>
  </a>
    <!-- Twitter -->
    <a href="https://x.com/SentientAGI">
        <img alt="Twitter Follow" src="https://img.shields.io/badge/Twitter-SentientAGI-white?logo=x"/>
    </a>
    <!-- Discord -->
    <a href="https://discord.gg/sentientfoundation">
        <img alt="Discord" src="https://img.shields.io/badge/Discord-SentientAGI-7289da?logo=discord&logoColor=white&color=7289da"/>
    </a>
    <!-- Hugging face -->
    <a href="https://huggingface.co/Sentientagi">
        <img src="https://img.shields.io/badge/Hugging_Face-SentientAGI-yellow?style=sociak&logo=huggingface"/>
    </a>
</p>

<!-- NPM Package Info -->
<p align="center">
    <!-- Release -->
    <a href="https://www.npmjs.com/package/sentient-agent-framework">
        <img src="https://img.shields.io/npm/v/sentient-agent-framework">
    </a>
    <!-- License -->
    <a href="https://www.npmjs.com/package/sentient-agent-framework">
        <img alt="License" src="https://img.shields.io/npm/dm/sentient-agent-framework">
    </a>
</p>


<h1 align="center">Sentient Agent Framework</h1>

> [!WARNING]
> **This TypeScript package is currently in beta and will likely change. It is not yet ready for production use.**

In addition to supporting OpenAI API compatible agents, Sentient Chat supports a custom, open source event system for agent responses. These events can be rendered in Sentient Chat to provide a richer user experience. This is particularly useful for streaming responses from an AI agent, when you might want to show the agent's work while the response is being generated, rather than having the user wait for the final response. **This TypeScript package provides an agent framework that can be used to build agents that serve Sentient Chat events.**

Examples of agents that use this framework/package can be found [here](https://github.com/sentient-agi/Sentient-Agent-Framework-Examples). A client for testing agents built with this framework is included in this package.

## Installation

```bash
npm install sentient-agent-framework
# or
yarn add sentient-agent-framework
# or
pnpm add sentient-agent-framework
```

## Usage

The simplest way to use this framework is to import and use the `AbstractAgent` class and the `DefaultServer` class.

#### AbstractAgent

The `AbstractAgent` class is lightweight and extensible. To use it, simply extend the class and implement the `assist()` method. Use the `ResponseHandler` object passed to the `assist()` method to emit events to the client.

#### DefaultServer

The `DefaultServer` class is designed to be used with the `AbstractAgent` class. A concrete implementation of the `AbstractAgent` class is passed into the `DefaultServer` constructor. The `DefaultServer` provides an SSE server with `/assist` endpoint and automatically streams events emitted in the `assist()` method to the client.

> [!NOTE]  
> The snippet below shows how to use the framework in a TypeScript project.

#### Example

```typescript
import * as dotenv from 'dotenv';
import {
  AbstractAgent,
  DefaultServer,
  Session,
  Query,
  ResponseHandler
} from 'sentient-agent-framework';

// Load environment variables
dotenv.config();

class SearchAgent extends AbstractAgent {
  private _modelProvider: any;
  private _searchProvider: any;

  constructor(name: string) {
    super(name);

    const modelApiKey = process.env.MODEL_API_KEY;
    if (!modelApiKey) {
      throw new Error("MODEL_API_KEY is not set");
    }
    this._modelProvider = new ModelProvider({ apiKey: modelApiKey });

    const searchApiKey = process.env.TAVILY_API_KEY;
    if (!searchApiKey) {
      throw new Error("TAVILY_API_KEY is not set");
    }
    this._searchProvider = new SearchProvider({ apiKey: searchApiKey });
  }

  // Implement the assist method as required by the AbstractAgent class
  async assist(
    session: Session,
    query: Query,
    responseHandler: ResponseHandler
  ): Promise<void> {
    // Search for information
    await responseHandler.emitTextBlock(
      "SEARCH", "Searching internet for results..."
    );
    
    const searchResults = await this._searchProvider.search(query.prompt);
    
    if (searchResults.results.length > 0) {
      // Use response handler to emit JSON to the client
      await responseHandler.emitJson(
        "SOURCES", { results: searchResults.results }
      );
    }
    
    if (searchResults.images.length > 0) {
      // Use response handler to emit JSON to the client
      await responseHandler.emitJson(
        "IMAGES", { images: searchResults.images }
      );
    }

    // Process search results
    // Use response handler to create a text stream to stream the final response to the client
    const finalResponseStream = responseHandler.createTextStream("FINAL_RESPONSE");
    
    for await (const chunk of this._processSearchResults(searchResults.results)) {
      // Use the text stream to emit chunks of the final response to the client
      await finalResponseStream.emitChunk(chunk);
    }
    
    // Mark the text stream as complete
    await finalResponseStream.complete();
    
    // Mark the response as complete
    await responseHandler.complete();
  }

  private async *_processSearchResults(searchResults: any): AsyncGenerator<string> {
    const processSearchResultsQuery = `Summarise the following search results: ${JSON.stringify(searchResults)}`;
    
    for await (const chunk of this._modelProvider.queryStream(processSearchResultsQuery)) {
      yield chunk;
    }
  }
}

// Create an instance of a SearchAgent
const agent = new SearchAgent("Search Agent");

// Create a server to handle requests to the agent
const server = new DefaultServer(agent);

// Run the server
server.run();
```

## Emitting events

Whether using the `AbstractAgent` or the `DefaultResponseHandler`, a `ResponseHandler` is created for every agent query and is used to emit events to the client.

#### Emitting text events

Text events are used to send single, complete messages to the client:

```typescript
await responseHandler.emitTextBlock(
  "PLAN", "Rephrasing user query..."
);
```

#### Emitting JSON events

JSON events are used to send JSON objects to the client:

```typescript
await responseHandler.emitJson(
  "SOURCES", { results: searchResults.results }
);
```

#### Emitting error events

Error events are used to send error messages to the client:

```typescript
await responseHandler.emitError(
  "ERROR", "An error occurred", 500, { details: "Additional error details" }
);
```

#### Completing a response

At the end of a response, `responseHandler.complete()` is called to signal the end of the response (this will emit a `DoneEvent` using the `Hook`):

```typescript
await responseHandler.complete();
```

#### Emitting a stream of text chunks

To stream a longer response one chunk at a time, use the `responseHandler.createTextStream` method. This returns a `StreamEventEmitter` that can be used to stream text to the client using the `emitChunk` method:

```typescript
const finalResponseStream = responseHandler.createTextStream(
  "FINAL_RESPONSE"
);

for await (const chunk of processSearchResults(searchResults.results)) {
  await finalResponseStream.emitChunk(chunk);
}
```

#### Completing a stream

At the end of the stream, `finalResponseStream.complete()` is called to signal the end of the stream (this will emit a `TextChunkEvent` with `is_complete=true`):

```typescript
await finalResponseStream.complete();
```

## Documentation

- [Interface Documentation](./interface/README.md)
- [Implementation Documentation](./implementation/README.md)